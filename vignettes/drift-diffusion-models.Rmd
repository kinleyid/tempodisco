---
title: "Drit diffusion models"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Visualizing models}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(tempodisco)
```

Drift diffusion models (DDMs; [Ratcliff, 1978](https://doi.org/10.1037/0033-295X.85.2.59)) model not only binary choices but also response times (RTs), and can be applied to intertemporal choice data ([Peters & D'Esposito, 2020](https://doi.org/10.1371/journal.pcbi.1007615)). Often, extreme RTs are first excluded, using either absolute or relative cutoffs. Here, we will exclude the fastest 2.5% and slowest 2.5% of responses.

```{r}
data("td_bc_single_ptpt")
rt_cutoffs <- quantile(td_bc_single_ptpt$rt, c(0.025, 0.975))
td_bc_single_ptpt <- subset(td_bc_single_ptpt, rt > rt_cutoffs[1] & rt < rt_cutoffs[2])
```

Next, we can fit a drift diffusion model. Here, for the sake of speed, we are providing starting values for the parameters that are close to optimal and are only testing the exponential discount function.

```{r}
ddm <- td_ddm(td_bc_single_ptpt, discount_function = 'exponential',
              v_par_starts = 0.01,
              beta_par_starts = 0.5,
              alpha_par_starts = 3.5,
              tau_par_starts = 0.9)
print(ddm)
```

As with other model classes (`td_bcnm`, `td_bclm`), we can plot the resulting discount function

```{r}
plot(ddm, log = 'x', verbose = F)
```

Moreover, because DDMs model RTs, we can compare predicted RTs to the actual data:

```{r}
predicted_rts <- predict(ddm, type = 'rt')
cor.test(predicted_rts, ddm$data$rt)
```

[Fontanesi et al. (2019)](https://doi.org/10.3758/s13423-018-1554-2) suggest applying a sigmoid transform to drift rates according the the following equation, which is reported by [Peters & D'Esposito (2020)](https://doi.org/10.1371/journal.pcbi.1007615) to improve model fit for intertemporal choice data:

$$\delta' = v_\text{max} \left(\frac{2}{1 + \exp\{-\delta\}} - 1\right)$$

We can incorporate this into the model using the argument `drift_transform = "sigmoid"`:

```{r}
ddm_sig <- td_ddm(td_bc_single_ptpt, discount_function = 'exponential', drift_transform = 'sigmoid',
              v_par_starts = 0.01,
              beta_par_starts = 0.5,
              alpha_par_starts = 3.5,
              tau_par_starts = 0.9)
print(BIC(ddm))
print(BIC(ddm_sig))
```

Sure enough, the model with the sigmoid transform performs better per the Bayesian information criterion.
